# Exploiting NVM PIM 


This is for "Exploiting Processing-in-memory for Searching and Clustering on High-dimensional Data"(under review).  
Similarity computation is a core subroutine of many searching and clustering algorithms on high-dimensional data. 
The performance bottleneck in the applications of high-dimensional data is due to substantial amount of data transferred from memory to processors, which is known as "memory wall" problem. 
This work proposes to utilize non-volatile memory (NVM), specifically, ReRAM based processing-in-memory (PIM) to accelerate a given similarity-based data searching and clustering algorithm. 

---------------------------------------------
## Accelerating algorithm with ReRAM PIM
We propose a framework to exploit ReRAM PIM to accelerate the computation of a given similarity-based searching and clustering algorithm. 
The commercial ReRAM PIM device is still inaccessible, like prior NVM PIM related research, our experiments are based on simulation.
The experiment software that we use:

- [Performance profiling tool]()
- [NVM PIM simulator](#)
- [Hardware-aware compress and optimization analyzer](#)

---------------------------------------------
## Performance Profiling tool
We use performance profiling which helps us identify the bottleneck of an algorithm.
ReRAM PIM mainly support sum, dot-product, and simple logic operation such as AND, OR. The limited functionality of ReRAM PIM makes it impractical to run the entire algorithm. Hence, we aim to identify the performance bottleneck, and explore PIM to promote the bottleneck.
We propose performance two kinds of profiling:
1. Performance breakdown by hardware components.

2. Performance breakdown by functions.

-------

### Performance breakdown by hardware components
You may use the popular processor profiling tool, PAPI, PCM and VTune.  
PAPI : https://icl.utk.edu/papi/  
PCM: https://github.com/opcm/pcm  
VTune: https://software.intel.com/content/www/us/en/develop/tools/vtune-profiler.html  


PAPI:  
With our experience, PAPI is most convenient as it support more general hardware platform with almost contemporary processors.
See [/PAPI/papi_example.cpp](https://github.com/Eilowangfang/ExploitNVMPIM/blob/master/PAPI/papi_example.cpp) as an example of using PAPI.

PCM:  
The usage of PCM is similar to PCM. PCM mostly refer to the events to access processor registers directly, and PAPI provide more packaged API interface.      
See [/PAPI/pcm_example.cpp](https://github.com/Eilowangfang/ExploitNVMPIM/blob/master/PCM/pcm_example.cpp) as an example of using PCM.  

-------------

### Performance breakdown by functions
To measure execution time of each function in given algorithm, we can simply use time system calls such as *clock()* and *clock_gettime()*.

---------------------------------------------
## NVM PIM simulator


### NVM system level emulator

Quartz: is a software-based NVM performance emulator from Hewlett Packard. 
It emulates NVM using DRAM and by extending a Linux memory file system to inject software-created delays to each file read and write I/O operation. 
Hence, we can use DRAM-based processing hardware to emulate a system with NVM such as STT-RAM, PCM, ReRAM, and 3D X-point as main memory.   
See quartz [code](https://github.com/HewlettPackard/quartz), [paper](https://dl.acm.org/doi/pdf/10.1145/2814576.2814806?download=true) for more details.


Quartz currently support only SandyBridge/IvyBridge/Haswell CPU:   
The Broadwell CPU such as Intel Xeon E5-2620v4 is not supported.  
We expend quartz souce code to support Browdwell Quartz, and you may refer to the folder: [/quartz-Broadwellsupport/](https://github.com/Eilowangfang/ExploitNVMPIM/tree/master/quartz_Barodwellsupport)

-----------------
### NVM circuit-level simulator
NVSim is most popular circuit-level simulator for NVM PIM. It aims to model NVM-based main memory such as STT-RAM, PCM and ReRAM. It is widely adopted to simulate the processing progress within NVM PIM devices.  NVSim uses the same modeling principles as the well-known CACTI, but it starts from scratch on the basis of a brand-new frame work with more flexibility in terms of bank/mat/subarray organization and periphral circuitry design. Such flexibility is necessary for emerging non-volatile memory technologies as the current status of most emerging NVMs is unknown.     
See NVSim [code](https://github.com/SEAL-UCSB/NVSim), [paper](https://ieeexplore.ieee.org/document/6218223) for more details.

---------
## Hardware-aware compress and optimization analyzer
Given ReRAM hardware and dataset to process, we might need to compress the dataset so as can manage it in ReRAM hardware.  
Given an algorithm, we also propose an optimization to combine PIM capability
and features of the algorithm.
See paper for more details. 

We provide an analyzer to determine the data compression and suitable optimization:
[/analyzer](https://github.com/Eilowangfang/ExploitNVMPIM/tree/master/nvmanalyzer).

-----------------
### Compile

    mkdir build
    cd build
    cmake ..
    make

### usage
You may modify the hardware configuration, dataset statistics, 
and algorithm necessary in file [nvsim.cfg](https://github.com/Eilowangfang/ExploitNVMPIM/blob/master/nvmanalyzer/nvsim.cfg).

Then in build folder, run:

    ./analyzer


